name: build androidplot
on:
  push:
    branches:
      - v1.5.10b # TODO change to master
jobs:
  build-and-test:
    runs-on: ubuntu-latest
    steps:
#      - shell: bash
#        env:
#          FOO: "somestuff"
#        run: |
#          echo $FOO | base64 | sed 's/ /\n/g' | base64 -d > output.txt
      - name: Decode Keystore
        env:
          ENCODED_STRING: ${{ secrets.DEMOAPP_KEYSTORE }}
        run: |
          echo $ENCODED_STRING | base64 -di > signing.keystore
      - name: Decode Keystore (2)
        env:
          ENCODED_KEYSTORE: ${{secrets.DEMOAPP_KEYSTORE}}
        run: |
          echo $ENCODED_KEYSTORE | base64 â€“di > signing.keystore
      - name: Checkout Code
        uses: actions/checkout@v3
      - name: Build and Test
        run: ./gradlew testDebugUnitTest jacocoTestDebugUnitTestReport
      - name: Build Release
        run: ./gradlew assembleRelease
      - name: Javadoc
        run: ./gradlew javadoc
      - name: Code Coverage
        run: bash <(curl -s https://codecov.io/bash)